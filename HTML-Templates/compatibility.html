{% extends 'base.html' %}

{% block content %}
<div class="max-w-3xl mx-auto py-12">
  <h2 class="text-3xl font-semibold text-center mb-6">Compatibility Checker</h2>

  <form method="post" class="max-w-md mx-auto">
    {% csrf_token %}
    <label for="other_username" class="block text-sm font-medium text-gray-300 mb-2">Enter username to compare with</label>
    <input id="other_username" name="other_username" value="{{ other_username }}" class="w-full p-3 rounded bg-gray-800 text-white mb-4" placeholder="other_username" />
    <div class="flex gap-4">
      <button type="submit" class="w-full bg-green-500 hover:bg-green-600 py-3 rounded text-white font-semibold">Check Compatibility</button>
      <a href="{% url 'profile' user.username %}" class="w-full text-center bg-gray-700 hover:bg-gray-600 py-3 rounded text-white">Back to Profile</a>
    </div>
  </form>

  <div class="mt-8 max-w-2xl mx-auto">
    {% if result %}
      {% if result.error %}
        <div class="bg-red-700 p-4 rounded">
          <p class="font-semibold">Error:</p>
          <p class="text-sm">{{ result.error }}{% if result.message %} - {{ result.message }}{% endif %}</p>
          {% if result.error == 'spotify_not_connected' %}
            <p class="text-sm mt-2">Both users need to authenticate with Spotify to compute compatibility.</p>
          {% endif %}
        </div>
      {% else %}
        <div class="bg-gray-900 p-6 rounded">
          <h3 class="text-2xl font-semibold mb-2">Compatibility: {{ result.score }}%</h3>
          <p class="text-sm text-gray-400 mb-4">Breakdown: Artist {{ result.breakdown.artist_score }}% â€” Genres {{ result.breakdown.genre_score }}%</p>
          <div class="mb-4">
            <h4 class="font-semibold">Shared Artists ({{ result.artist_overlap|length }})</h4>
            {% if result.artist_overlap %}
              <ul class="list-disc list-inside text-sm text-gray-300">
                {% for aid in result.artist_overlap %}
                  <li>{{ aid }}</li>
                {% endfor %}
              </ul>
            {% else %}
              <p class="text-sm text-gray-500">No shared top artists.</p>
            {% endif %}
          </div>

          <div>
            <h4 class="font-semibold">Top Shared Genres</h4>
            {% if result.top_shared_genres %}
              <p class="text-sm text-gray-300">{{ result.top_shared_genres|join:", " }}</p>
            {% else %}
              <p class="text-sm text-gray-500">No shared genres.</p>
            {% endif %}
          </div>
        </div>
      {% endif %}
    {% endif %}
  </div>
</div>
{% endblock %}
