{% extends 'base.html' %}

{% block title %}Discussion - Matchify{% endblock %}

{% block head %}
<style>
/* subtle green glow matching home page green (Tailwind green-500) */
.glow-green {
    text-shadow: 0 0 8px rgba(34,197,94,0.45), 0 0 18px rgba(34,197,94,0.12);
}
</style>
{% endblock %}

{% block content %}
<div class="max-w-4xl mx-auto py-12">
            <h1 class="text-3xl font-bold text-center mb-6 text-green-500 glow-green">Community Discussion</h1>

    <div class="bg-gray-800 p-6 rounded-lg mb-6">
    <h2 class="text-xl font-semibold mb-2 text-purple-500">Create a Post</h2>
        <form id="post-form" method="post" enctype="multipart/form-data">
            {% csrf_token %}
            <div class="mb-3">
                {{ form.content }}
            </div>
            <div class="flex items-center space-x-3">
                <!-- File icon (no background) using a filled document SVG; color controlled by text-blue-700 -->
                <label for="post-image-input" class="inline-flex items-center justify-center text-blue-700 hover:text-blue-800 w-10 h-10 cursor-pointer" aria-hidden="true">
                    <!-- filled document icon -->
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 64 64" class="w-8 h-8" fill="currentColor" aria-hidden="true">
                        <path d="M45 2H19a6 6 0 0 0-6 6v48a6 6 0 0 0 6 6h26a6 6 0 0 0 6-6V18L45 2zM41 6.6L55.4 21H42a1 1 0 0 1-1-1V6.6zM18 10a1 1 0 0 1 1-1h20v12a4 4 0 0 0 4 4h12v26a3 3 0 0 1-3 3H19a3 3 0 0 1-3-3V10z"/>
                        <rect x="20" y="30" width="24" height="4" rx="1" fill="white" opacity="1"/>
                        <rect x="20" y="38" width="18" height="4" rx="1" fill="white" opacity="1"/>
                    </svg>
                </label>
                <div id="selected-file-name" class="text-sm text-gray-300">No file chosen</div>

                <button type="submit" class="ml-auto mt-0 bg-green-500 hover:bg-green-600 text-white font-semibold py-2 px-4 rounded">Post</button>
            </div>
            {{ form.image }}
        </form>
    </div>

    <div class="space-y-4">
        {% for item in posts %}
            {% with post=item.post image_exists=item.image_exists %}
            <div class="bg-gray-800 p-4 rounded-lg">
                <div class="flex items-center justify-between mb-2">
                    <div class="font-semibold text-blue-500">{{ post.author.username }}</div>
                    <div class="text-xs text-gray-400">{{ post.created_at }}</div>
                </div>
                <div class="text-gray-200">{{ post.content|linebreaksbr }}</div>
                {% if post.image and image_exists %}
                    <div class="mt-3">
                        <a href="{{ post.image.url }}" target="_blank" rel="noopener noreferrer">
                            <img src="{{ post.image.url }}" alt="Post image" class="w-full rounded-lg shadow-md mx-auto object-contain max-h-96">
                        </a>
                    </div>
                {% elif post.image and not image_exists %}
                    <div class="mt-3 text-sm text-gray-400 italic">Image not available</div>
                {% endif %}
            </div>
            {% endwith %}
        {% empty %}
            <p class="text-center text-gray-400">No posts yet â€” be the first to share!</p>
        {% endfor %}
    </div>
</div>
    <!-- Bottom-centered Back to Home button (matches provided design) -->
    <a href="{% url 'home' %}" aria-label="Back to Home" class="fixed bottom-6 left-1/2 transform -translate-x-1/2 bg-blue-400 hover:bg-blue-500 text-white font-bold py-3 px-10 rounded-full shadow-md transition-transform transform-gpu hover:scale-105 flex items-center space-x-3">
        <span class="text-2xl leading-none">&larr;</span>
        <span class="text-lg">Back to Home</span>
    </a>

    <!-- Show selected filename for file input -->
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const fileInput = document.getElementById('post-image-input');
            const filenameDisplay = document.getElementById('selected-file-name');
            if (fileInput && filenameDisplay) {
                fileInput.addEventListener('change', function () {
                    const file = fileInput.files[0];
                    filenameDisplay.textContent = file ? file.name : 'No file chosen';
                });
            }
        });
    </script>

{% endblock %}
